{
  "kind": "build_request",
  "title": "Fix profile creation error on new device login",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-3",
      "text": "Investigate and fix the 'Unable to save profile. Please try logging in again.' error that occurs when a new user (Lavanya, phone: 1237894561) tries to complete profile setup with the Ambulance Crew role selected on a new device",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "Unable to save profile. Please try logging in again."
        ]
      },
      "acceptanceCriteria": [
        "New users can successfully create their profile on first login from any device",
        "The error message shown in the screenshot no longer appears during valid profile creation attempts",
        "Profile data (name: Lavanya, phone: 1237894561, role: Ambulance Crew) is correctly saved to the backend",
        "User is properly redirected to the Ambulance Interface after successful profile creation"
      ]
    },
    {
      "id": "REQ-4",
      "text": "Add comprehensive error logging to the profile creation flow in both ProfileSetup.tsx and the backend createUserProfile function to capture the exact failure reason (authorization issues, validation errors, or backend state conflicts)",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-latest"
        ]
      },
      "acceptanceCriteria": [
        "Backend logs include caller principal, input validation results, and any authorization check failures during createUserProfile calls",
        "Frontend logs include the full error response from the backend including error type and message",
        "Console output clearly identifies whether the error is due to authorization, validation, or backend logic"
      ]
    }
  ],
  "constraints": [
    "Do not change the existing authorization model or MixinAuthorization implementation",
    "Preserve the current phone number validation logic (10 digits)",
    "Maintain the existing error handling categories in ProfileSetup (validation, authorization, network)"
  ],
  "nonGoals": [
    "Redesigning the profile setup UI",
    "Adding new profile fields beyond name, phone, and role",
    "Changing the authentication mechanism from Internet Identity"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}