{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Fix blank white screen on production load",
  "requirements": [
    {
      "id": "REQ-1",
      "summary": "Add comprehensive error logging to identify the root cause of the blank white screen in production",
      "acceptanceCriteria": [
        "Console logs capture all initialization errors",
        "Error details are visible in browser DevTools console",
        "Logs distinguish between auth failures, network issues, and render errors"
      ],
      "file_operations": [
        {
          "path": "frontend/src/main.tsx",
          "operation": "modify",
          "description": "Add error logging for React Query client initialization failures, including onError callbacks in the QueryClient configuration to capture and log all query errors during bootstrap"
        },
        {
          "path": "frontend/src/hooks/useInternetIdentity.ts",
          "operation": "modify",
          "description": "Add comprehensive console.error logging for Internet Identity provider initialization failures, AuthClient creation errors, and identity loading failures with detailed error messages"
        },
        {
          "path": "frontend/src/hooks/useActor.ts",
          "operation": "modify",
          "description": "Add error logging for actor creation failures, including canister connection errors, identity validation failures, and any exceptions during actor initialization with context about the failure point"
        },
        {
          "path": "frontend/src/App.tsx",
          "operation": "modify",
          "description": "Add logging for uncaught exceptions during app bootstrap, profile loading errors, and role-based routing failures with timestamps and error context"
        }
      ]
    },
    {
      "id": "REQ-2",
      "summary": "Add a loading fallback UI that displays while the app initializes, preventing a blank screen during bootstrap",
      "acceptanceCriteria": [
        "Users see a loading indicator immediately on page load",
        "Loading state is visible until React Query and Internet Identity providers are ready",
        "Loading UI uses the app's theme colors"
      ],
      "file_operations": [
        {
          "path": "frontend/src/main.tsx",
          "operation": "modify",
          "description": "Wrap the App component tree with React.Suspense using a loading fallback that displays a centered spinner with the app's theme colors during initialization of React Query and Internet Identity providers"
        },
        {
          "path": "frontend/src/components/LoadingFallback.tsx",
          "operation": "create",
          "description": "Create a LoadingFallback component that displays a centered spinner using Tailwind theme colors with a loading message, ensuring it covers the full viewport and prevents blank screen display during app bootstrap"
        }
      ]
    },
    {
      "id": "REQ-3",
      "summary": "Wrap the root App component with ErrorBoundary to catch and display any render-time errors",
      "acceptanceCriteria": [
        "ErrorBoundary catches all React rendering errors",
        "CrashFallback is displayed when errors occur",
        "Error details are logged to console"
      ],
      "file_operations": [
        {
          "path": "frontend/src/main.tsx",
          "operation": "modify",
          "description": "Wrap the App component with the existing ErrorBoundary component, ensuring it catches all render-time errors and displays the CrashFallback UI with error details logged to console"
        },
        {
          "path": "frontend/src/components/ErrorBoundary.tsx",
          "operation": "modify",
          "description": "Enhance ErrorBoundary to log caught errors to console.error with stack traces and component hierarchy information before displaying CrashFallback"
        }
      ]
    },
    {
      "id": "REQ-4",
      "summary": "Add defensive null checks and error handling in App.tsx for cases where the actor, identity, or profile data fails to load",
      "acceptanceCriteria": [
        "App handles missing or failed actor creation gracefully",
        "Clear error messages are shown when profile loading fails",
        "Users can retry failed operations"
      ],
      "file_operations": [
        {
          "path": "frontend/src/App.tsx",
          "operation": "modify",
          "description": "Add null checks for actor availability before rendering role-based UI, handle profile loading failures with user-friendly error messages, and provide retry buttons for failed operations instead of crashing"
        },
        {
          "path": "frontend/src/components/ErrorState.tsx",
          "operation": "create",
          "description": "Create an ErrorState component that displays user-friendly error messages with retry buttons for actor creation failures, profile loading errors, and network issues with proper error context"
        }
      ]
    },
    {
      "id": "REQ-5",
      "summary": "Verify that the Leaflet CDN script loads successfully by adding an onload handler and error fallback",
      "acceptanceCriteria": [
        "Leaflet CDN load success/failure is logged",
        "App displays an error if Leaflet fails to load",
        "Map components handle missing Leaflet gracefully"
      ],
      "file_operations": [
        {
          "path": "frontend/index.html",
          "operation": "modify",
          "description": "Add onload and onerror event handlers to the Leaflet CDN script tag that log success/failure to console and set a window.leafletLoaded flag to track loading state"
        },
        {
          "path": "frontend/src/components/RealtimeMap.tsx",
          "operation": "modify",
          "description": "Add defensive check for window.L availability before initializing the map, display an error message if Leaflet is not loaded, and handle missing Leaflet gracefully with a fallback UI showing a map loading error"
        },
        {
          "path": "frontend/src/pages/AmbulanceInterface.tsx",
          "operation": "modify",
          "description": "Add check for Leaflet availability before rendering the RealtimeMap component and display an error message if Leaflet failed to load with instructions to refresh the page"
        },
        {
          "path": "frontend/src/pages/PoliceInterface.tsx",
          "operation": "modify",
          "description": "Add check for Leaflet availability before rendering the RealtimeMap component and display an error message if Leaflet failed to load with instructions to refresh the page"
        }
      ]
    }
  ]
}